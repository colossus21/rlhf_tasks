<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Space Merge</title>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            text-align: center;
        }

        #board {
            width: 360px;
            height: 360px;
            background: #1a1a2e;
            border: 2px solid #30304a;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            padding: 10px;
            box-sizing: border-box;
            margin: 20px auto;
        }

        .cell {
            width: 50px;
            height: 50px;
            background: #16213e;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
            color: #776e65;
            animation: appear 0.3s ease-out;
        }

        @keyframes appear {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }

        #new-game { background: #e94560; }
        #use-powerup { background: #3498db; }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .pulsing {
            animation: pulse 1s infinite;
        }

        .star {
            position: absolute;
            width: 1px;
            height: 1px;
            background: white;
            animation: moveStar linear infinite;
        }

        @keyframes moveStar {
            from { transform: translateY(0); }
            to { transform: translateY(-100vh); }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div>
        <span>Score: <span id="score">0</span></span> |
        <span>High Score: <span id="highScore">0</span></span> |
        <span>Power-up: <span id="powerup">None</span></span>
    </div>
    <div id="board"></div>
    <button id="new-game">New Game</button>
    <button id="use-powerup" disabled>Use Power-up</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const board = document.getElementById('board');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('highScore');
        const powerupDisplay = document.getElementById('powerup');
        const newGameBtn = document.getElementById('new-game');
        const usePowerupBtn = document.getElementById('use-powerup');
        let boardState = Array(6).fill().map(() => Array(6).fill(null));
        let score = 0;
        let highScore = 0;
        let currentPowerup = null;

        function createStar() {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = `${Math.random() * 100}vw`;
            star.style.animationDuration = `${Math.random() * 10 + 5}s`;
            document.body.appendChild(star);
            setTimeout(() => star.remove(), 10000);
        }

        for(let i = 0; i < 100; i++) {
            createStar();
        }

        function startGame() {
            boardState = Array(6).fill().map(() => Array(6).fill(null));
            score = 0;
            updateScore();
            addTile();
            addTile();
            renderBoard();
        }

        function addTile() {
            const emptyCells = [];
            boardState.forEach((row, y) => {
                row.forEach((cell, x) => {
                    if (!cell) emptyCells.push({x, y});
                });
            });

            if (emptyCells.length === 0) return;

            const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            const value = Math.random() < 0.9 ? 2 : (Math.random() < 0.1 ? [8, 16, 32, 64, 128][Math.floor(Math.random() * 5)] : 4);
            boardState[randomCell.y][randomCell.x] = {value, merged: false, pulse: value > 4};
        }

        function renderBoard() {
            board.innerHTML = '';
            boardState.forEach((row, y) => {
                row.forEach((tile, x) => {
                    if (tile) {
                        const cell = document.createElement('div');
                        cell.className = `cell ${tile.pulse ? 'pulsing' : ''}`;
                        cell.textContent = tile.value;
                        cell.style.color = tile.value < 16 ? '#776e65' : 'white';
                        cell.style.background = `hsl(${(Math.log2(tile.value) / 10) * 240}, 70%, 40%)`;
                        board.appendChild(cell);
                    } else {
                        const emptyCell = document.createElement('div');
                        emptyCell.className = 'cell';
                        board.appendChild(emptyCell);
                    }
                });
            });
        }

        function move(direction) {
            let moved = false;
            const transpose = direction === 'ArrowRight' || direction === 'ArrowLeft';
            const reverse = direction === 'ArrowDown' || direction === 'ArrowRight';

            const processRow = (row, y) => {
                let filteredRow = row.filter(x => x);
                if (reverse) filteredRow.reverse();
                for (let i = 0; i < filteredRow.length - 1; i++) {
                    if (filteredRow[i].value === filteredRow[i + 1].value && !filteredRow[i].merged && !filteredRow[i + 1].merged) {
                        filteredRow[i].value *= 2;
                        filteredRow[i].merged = true;
                        filteredRow.splice(i + 1, 1);
                        score += filteredRow[i].value;
                        moved = true;
                    }
                }
                filteredRow = filteredRow.map(tile => ({...tile, merged: false}));
                if (reverse) filteredRow.reverse();
                return Array(6).fill(null).map((_, i) => filteredRow[i] || null);
            };

            if (transpose) boardState = boardState[0].map((_, i) => boardState.map(row => row[i]));
            if (moved = boardState.some((_, y) => processRow(boardState[y], y).some((_, x) => boardState[y][x] !== boardState[y][x]))) {
                addTile();
                updateScore();
                checkPowerup();
            }
            if (transpose) boardState = boardState[0].map((_, i) => boardState.map(row => row[i]));
            renderBoard();
        }

        function updateScore() {
            scoreDisplay.textContent = score;
            if (score > highScore) {
                highScore = score;
                highScoreDisplay.textContent = highScore;
            }
        }

        function checkPowerup() {
            if (!currentPowerup && Math.random() < 0.2) {
                const powerups = ['Merge', 'Double', 'Clear'];
                currentPowerup = powerups[Math.floor(Math.random() * powerups.length)];
                powerupDisplay.textContent = currentPowerup;
                usePowerupBtn.disabled = false;
            }
        }

        function usePowerup() {
            if (!currentPowerup) return;
            switch(currentPowerup) {
                case 'Merge':
                    // Implement merge logic
                    break;
                case 'Double':
                    // Implement double logic
                    break;
                case 'Clear':
                    // Implement clear logic
                    break;
            }
            currentPowerup = null;
            powerupDisplay.textContent = 'None';
            usePowerupBtn.disabled = true;
        }

        document.addEventListener('keydown', (event) => {
            if(['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {
                move(event.key);
            }
        });

        newGameBtn.onclick = startGame;
        usePowerupBtn.onclick = usePowerup;

        startGame();
    });
</script>
</body>
</html>