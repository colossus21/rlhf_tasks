<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phaser Collect Game</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid #333;
        }
    </style>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
</head>
<body>

<script type="text/javascript">
    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        scene: {
            preload: preload,
            create: create,
            update: update
        },
        physics: {
            default: 'arcade',
            arcade: {
                debug: false
            }
        }
    };

    const game = new Phaser.Game(config);
    let player1, player2;
    let cursors1, cursors2;
    let shapes;
    let scoreText1, scoreText2;
    let timerText;
    let timerEvent;
    let gameOver = false;

    function preload() {
        // No images to preload since we're using shapes
    }

    function create() {
        // Players
        player1 = this.physics.add.sprite(50, 50, 'player').setTint(0xff0000);
        player2 = this.physics.add.sprite(750, 550, 'player').setTint(0x0000ff);
        cursors1 = this.input.keyboard.createCursorKeys();
        cursors2 = this.input.keyboard.addKeys({ 'up': Phaser.Input.Keyboard.KeyCodes.W, 'down': Phaser.Input.Keyboard.KeyCodes.S, 'left': Phaser.Input.Keyboard.KeyCodes.A, 'right': Phaser.Input.Keyboard.KeyCodes.D });

        // Collectible shapes
        shapes = this.physics.add.group();

        // Spawning shapes
        this.time.addEvent({
            delay: 1000,
            callback: spawnShape,
            callbackScope: this,
            loop: true
        });

        // Score
        scoreText1 = this.add.text(16, 16, 'P1: 0', { fontSize: '32px', fill: '#ff0000' });
        scoreText2 = this.add.text(650, 16, 'P2: 0', { fontSize: '32px', fill: '#0000ff' });

        // Timer
        let timeLeft = 30;
        timerText = this.add.text(375, 16, 'Time: 30', { fontSize: '32px', fill: '#000' });
        timerEvent = this.time.addEvent({
            delay: 1000,
            callback: () => {
                timeLeft--;
                timerText.setText('Time: ' + timeLeft);
                if (timeLeft === 0) {
                    gameOver = true;
                    this.physics.pause();
                    declareWinner(this);
                }
            },
            callbackScope: this,
            loop: true
        });

        // Physics for collision
        this.physics.add.collider(player1, shapes, collectShape, null, this);
        this.physics.add.collider(player2, shapes, collectShape, null, this);
    }

    function update() {
        if (!gameOver) {
            // Player 1 movement
            player1.setVelocity(0);
            if (cursors1.left.isDown) player1.setVelocityX(-160);
            else if (cursors1.right.isDown) player1.setVelocityX(160);
            if (cursors1.up.isDown) player1.setVelocityY(-160);
            else if (cursors1.down.isDown) player1.setVelocityY(160);

            // Player 2 movement
            player2.setVelocity(0);
            if (cursors2.left.isDown) player2.setVelocityX(-160);
            else if (cursors2.right.isDown) player2.setVelocityX(160);
            if (cursors2.up.isDown) player2.setVelocityY(-160);
            else if (cursors2.down.isDown) player2.setVelocityY(160);
        }
    }

    function spawnShape() {
        if (gameOver) return;

        let x = Phaser.Math.Between(100, 700);
        let y = Phaser.Math.Between(100, 500);
        let shapeType = Phaser.Math.RND.weightedPick([10, 30, 50]); // Star, Circle, Triangle probabilities

        let shape;
        if (shapeType === 10) shape = shapes.create(x, y, 'star').setTint(0xffff00); // Star
        else if (shapeType === 30) shape = shapes.create(x, y, 'circle').setTint(0xff00ff); // Circle
        else shape = shapes.create(x, y, 'triangle').setTint(0x00ffff); // Triangle

        shape.setScale(0.5);
        shape.setRotation(Phaser.Math.Between(0, 360));
        shape.setVelocity(Phaser.Math.Between(-50, 50), Phaser.Math.Between(-50, 50));
    }

    function collectShape(player, shape) {
        shape.disableBody(true, true);
        if (player === player1) scoreText1.setText('P1: ' + (parseInt(scoreText1.text.split(': ')[1]) + (shape.texture.key === 'star' ? 10 : shape.texture.key === 'circle' ? 7 : 5)));
        else scoreText2.setText('P2: ' + (parseInt(scoreText2.text.split(': ')[1]) + (shape.texture.key === 'star' ? 10 : shape.texture.key === 'circle' ? 7 : 5)));
    }

    function declareWinner(scene) {
        let p1Score = parseInt(scoreText1.text.split(': ')[1]);
        let p2Score = parseInt(scoreText2.text.split(': ')[1]);
        let result = (p1Score > p2Score) ? 'Player 1 Wins!' : (p1Score < p2Score ? 'Player 2 Wins!' : 'It\'s a Tie!');
        let text = scene.add.text(300, 300, result, { fontSize: '48px', fill: '#000' });
        text.setOrigin(0.5);

        // Add restart button
        let restartButton = scene.add.text(350, 350, 'Restart', { fontSize: '32px', fill: '#000' });
        restartButton.setInteractive({ useHandCursor: true });
        restartButton.on('pointerdown', () => location.reload());
    }
</script>

</body>
</html>