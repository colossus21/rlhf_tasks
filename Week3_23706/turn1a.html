<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect 4 with a Twist</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; }
    </style>
</head>
<body>
<script>
const config = {
    type: Phaser.AUTO,
    width: 700,
    height: 600,
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

const game = new Phaser.Game(config);

let board;
let currentPlayer;
let gameOver;
let scoreText;
let turnText;
let scores;

function preload() {
    this.load.image('cell', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF8WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0NDYwLCAyMDIwLzA1LzEyLTE2OjA0OjE3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMiAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIzLTA1LTI3VDE1OjQ3OjMzKzAyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMy0wNS0yN1QxNTo0ODoyOCswMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMy0wNS0yN1QxNTo0ODoyOCswMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpmYmMzMWNhOS01OWE5LTM5NDUtOTUyZi1hNmM3ZDg1ODU2NGMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6ZTVmYmQ4YTQtMTk1Yy0xMDRkLWJkOTYtY2Q5NTMxZDUyNTNhIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZTVmYmQ4YTQtMTk1Yy0xMDRkLWJkOTYtY2Q5NTMxZDUyNTNhIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDplNWZiZDhhNC0xOTVjLTEwNGQtYmQ5Ni1jZDk1MzFkNTI1M2EiIHN0RXZ0OndoZW49IjIwMjMtMDUtMjdUMTU6NDc6MzMrMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMS4yIChXaW5kb3dzKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZmJjMzFjYTktNTlhOS0zOTQ1LTk1MmYtYTZjN2Q4NTg1NjRjIiBzdEV2dDp3aGVuPSIyMDIzLTA1LTI3VDE1OjQ4OjI4KzAyOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMiAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+zt7HLwAAAWRJREFUeJzt3LEOgjAUQNFWjf//y3Vh1sHEGBMxltI+es9GHZD0hgctxTRN0+SYx3F8fM6cc5qmh/tyzjnnPB+Px9v7+fVNuPecc16v19v7+TVcO/+3xhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcaYH88bGRZR3rUvE8QAAAAASUVORK5CYII=');
}

function create() {
    board = Array(6).fill().map(() => Array(7).fill(0));
    currentPlayer = 1;
    gameOver = false;
    scores = [0, 0];

    for (let row = 0; row < 6; row++) {
        for (let col = 0; col < 7; col++) {
            const cell = this.add.image(col * 100 + 50, row * 100 + 50, 'cell');
            cell.setInteractive();
            cell.on('pointerdown', () => dropToken(col));
        }
    }

    scoreText = this.add.text(10, 10, 'Player 1: 0 | Player 2: 0', { fontSize: '24px', fill: '#000' });
    turnText = this.add.text(10, 550, 'Player 1\'s turn', { fontSize: '24px', fill: '#000' });
}

function update() {
    // This function is called every frame, but we don't need it for this game
}

function dropToken(col) {
    if (gameOver) return;

    for (let row = 5; row >= 0; row--) {
        if (board[row][col] === 0) {
            board[row][col] = currentPlayer;
            drawToken(row, col);
            checkForWin();
            switchPlayer();
            return;
        }
    }
}

function drawToken(row, col) {
    const scene = game.scene.scenes[0];
    const color = currentPlayer === 1 ? 0xff0000 : 0xffff00;
    scene.add.circle(col * 100 + 50, row * 100 + 50, 40, color);
}

function checkForWin() {
    const directions = [
        [0, 1], [1, 0], [1, 1], [1, -1]
    ];

    for (let row = 0; row < 6; row++) {
        for (let col = 0; col < 7; col++) {
            if (board[row][col] === 0) continue;

            for (const [dx, dy] of directions) {
                let count = 0;
                let x = col;
                let y = row;

                while (x >= 0 && x < 7 && y >= 0 && y < 6 && board[y][x] === currentPlayer) {
                    count++;
                    x += dx;
                    y += dy;
                }

                if (count >= 4) {
                    removeTokens(row, col, dx, dy);
                    updateScore();
                    return;
                }
            }
        }
    }
}

function removeTokens(row, col, dx, dy) {
    const scene = game.scene.scenes[0];
    for (let i = 0; i < 4; i++) {
        board[row][col] = 0;
        scene.children.list.forEach(child => {
            if (child.type === 'Arc' && 
                child.x === col * 100 + 50 && 
                child.y === row * 100 + 50) {
                child.destroy();
            }
        });
        row += dy;
        col += dx;
    }
}

function updateScore() {
    scores[currentPlayer - 1]++;
    scoreText.setText(`Player 1: ${scores[0]} | Player 2: ${scores[1]}`);

    if (scores[currentPlayer - 1] === 3) {
        gameOver = true;
        turnText.setText(`Player ${currentPlayer} wins!`);
    }
}

function switchPlayer() {
    currentPlayer = currentPlayer === 1 ? 2 : 1;
    if (!gameOver) {
        turnText.setText(`Player ${currentPlayer}'s turn`);
    }
}
</script>
</body>
</html>